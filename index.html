<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Road Trip Discoverer</title>
    
    <link rel="stylesheet" href="https://unpkg.com/@geoapify/geocoder-autocomplete@^1/styles/minimal.css">
    <script src="https://unpkg.com/@geoapify/geocoder-autocomplete@^1/dist/index.bundle.min.js"></script>

    <style>
        :root { --bg: #ffffff; --text: #1a1a1a; --accent: #007aff; --secondary: #f2f2f7; --danger: #ff3b30; }
        body { margin: 0; font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; }

        .search-section { margin-bottom: 30px; }
        .input-label { font-size: 0.8rem; font-weight: bold; color: #888; margin-bottom: 5px; display: block; }
        
        /* This ensures the containers are visible and ready for the library */
        .autocomplete-container { 
            margin-bottom: 20px; 
            position: relative; 
            min-height: 40px; 
            border: 1px solid #ddd; 
            border-radius: 8px;
        }
        
        .travel-btn { 
            width: 100%; padding: 16px; background: var(--accent); color: white; 
            border: none; border-radius: 12px; font-size: 1.1rem; font-weight: bold; 
            cursor: pointer; transition: 0.2s;
        }
        .travel-btn:hover { background: #0056b3; }

        .dashboard { background: var(--secondary); padding: 25px; border-radius: 20px; margin-top: 30px; display: none; }
        .temp { font-size: 3rem; font-weight: 800; margin: 0; }
    </style>
</head>
<body>

<div class="container">
    <div class="search-section">
        <h1>Travel Smarter</h1>
        
        <label class="input-label">FROM</label>
        <div id="origin-autocomplete" class="autocomplete-container"></div>
        
        <label class="input-label">TO</label>
        <div id="destination-autocomplete" class="autocomplete-container"></div>
        
        <button class="travel-btn" onclick="startJourney()">Travel!</button>
    </div>

    <div id="results" class="dashboard">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div>
                <h2 id="dest-name" style="margin:0">Destination</h2>
                <p id="weather-text" style="margin:0; color:#666">Checking skies...</p>
            </div>
            <div class="temp" id="temp-val">--Â°C</div>
        </div>

        <div id="packing-card" style="background:white; padding:15px; border-radius:12px; margin-top:20px;">
            <h4 style="margin:0 0 10px 0; color:#888;">SMART PACKING</h4>
            <ul id="packing-items" style="margin:0; padding-left:20px; font-size:0.9rem;"></ul>
        </div>

        <h3 style="margin-top:30px">Discovery Itinerary</h3>
        <div id="itinerary-list"></div>
    </div>
</div>

<script>
    // 1. YOUR API KEYS
    const GEO_KEY = "bb34a64a008b4c2f89ac485d4f09f7c7"; 
    const WEATHER_KEY = ""; 

    let selectedDest = { name: "", lat: null, lon: null };

    // 2. Wait for page to load before initializing the boxes
    document.addEventListener("DOMContentLoaded", function() {
        const originAC = new autocomplete.GeocoderAutocomplete(
            document.getElementById("origin-autocomplete"), GEO_KEY, 
            { placeholder: "Current location...", filter: { countrycode: ["my"] } }
        );

        const destAC = new autocomplete.GeocoderAutocomplete(
            document.getElementById("destination-autocomplete"), GEO_KEY, 
            { placeholder: "Where to?", filter: { countrycode: ["my"] } }
        );

        destAC.on('select', (location) => {
            if (location) {
                selectedDest.name = location.properties.city || location.properties.name;
                selectedDest.lat = location.properties.lat;
                selectedDest.lon = location.properties.lon;
            }
        });
    });

    // 3. The "Travel!" Button Function
    async function startJourney() {
        if (!selectedDest.name) {
            alert("Please select a destination from the dropdown list!");
            return;
        }

        document.getElementById('results').style.display = 'block';
        document.getElementById('dest-name').innerText = selectedDest.name;
        
        fetchWeather(selectedDest.lat, selectedDest.lon);
        renderItinerary();
    }

    async function fetchWeather(lat, lon) {
        // Updated to use a standard current weather fetch for the user's key
        const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${WEATHER_KEY}`;
        
        try {
            const res = await fetch(url);
            const data = await res.json();
            
            document.getElementById('temp-val').innerText = `${Math.round(data.main.temp)}Â°C`;
            document.getElementById('weather-text').innerText = data.weather[0].description;
            
            const isRainy = data.weather[0].main.includes("Rain");
            updatePacking(isRainy);
        } catch (e) {
            console.error("Weather failed:", e);
        }
    }

    function updatePacking(isRainy) {
        const list = document.getElementById('packing-items');
        let items = ["Breathable clothes", "Power bank", "Sunscreen"];
        if (isRainy) items.push("<strong>Umbrella / Poncho</strong>", "Waterproof bag");
        list.innerHTML = items.map(i => `<li>${i}</li>`).join('');
    }

    function renderItinerary() {
        const stops = [
            { name: "Lemang To'ki", desc: "Best pitstop for bamboo rice.", time: "10m detour" },
            { name: "Patin Tempoyak Pak Akob", desc: "Famous Pahang fish broth.", time: "5m detour" }
        ];
        document.getElementById('itinerary-list').innerHTML = stops.map(s => `
            <div style="border-left:2px solid #ddd; padding-left:15px; margin-bottom:20px; position:relative;">
                <strong>${s.name}</strong><br><small>${s.desc}</small><br>
                <span style="font-size:0.7rem; color: #aaa;">ðŸ•’ ${s.time}</span>
            </div>
        `).join('');
    }
</script>

</body>
</html>
